namespace = ming_crisis

# Mandate Questioned
country_event = {
	id = ming_crisis.1
	title = "ming_crisis.1.t"
	desc = "ming_crisis.1.d"
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		hidden_effect = {
			set_country_flag = had_ming_crisis_country_flag
			random_owned_province = { 
				limit = {
					is_state = yes
					superregion = china_superregion
				}
				spawn_rebels = {
					type = anti_tax_rebels 
					size = 3
					unrest = 5
				}
			}
			random_owned_province = { 
				limit = {
					is_state = yes
					superregion = china_superregion
				}
				spawn_rebels = {
					type = anti_tax_rebels 
					size = 3
					unrest = 5
				}
			}
			random_owned_province = { 
				limit = {
					is_state = yes
					superregion = china_superregion
				}
				spawn_rebels = {
					type = anti_tax_rebels 
					size = 3
					unrest = 5
				}
			}
			random_owned_province = { 
				limit = {
					is_state = yes
					superregion = china_superregion
				}
				spawn_rebels = {
					type = anti_tax_rebels 
					size = 3
					unrest = 5
				}
			}
			random_owned_province = { 
				limit = {
					is_state = yes
					superregion = china_superregion
				}
				spawn_rebels = {
					type = anti_tax_rebels 
					size = 3
					unrest = 5
				}
			}
			random_owned_province = { 
				limit = {
					is_state = yes
					superregion = china_superregion
				}
				spawn_rebels = {
					type = anti_tax_rebels 
					size = 3
					unrest = 5
				}
			}
		}
	}
	
	option = {
		name = ming_crisis.1.a
		add_stability = -2
		add_mandate = -25
		add_corruption = 5
	}
}

# The Mandate Restored
country_event = {
	id = ming_crisis.2
	title = "ming_crisis.2.t"
	desc = "ming_crisis.2.d"
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = ming_crisis.2.a
		add_stability = 1
		add_mandate = 10
	}
}



# Yunnan Protectorate
country_event = {
	id = ming_crisis.4
	title = "ming_crisis.4.t"
	desc = "ming_crisis.4.d"
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	major = yes
	
	trigger = {
		NOT = { exists = CDL }
		num_of_owned_provinces_with = {
			value = 10
			region = xinan_region
			controlled_by = REB
		}
		any_owned_province = {
			OR = {
				area = yun_gui_area
				area = chuannan_area
				area = yun_gui_borderland_area
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			every_owned_province = {
				limit = {
					OR = {
						controlled_by = REB
						controlled_by = ROOT
					}
					OR = {
						area = yun_gui_area
						area = chuannan_area
						area = yun_gui_borderland_area
					}
					OR = {
						controlled_by = REB
						controlled_by = ROOT
					}
					NOT = { is_core = CDL }
				}
				add_core = CDL
				clear_rebels = yes
			}
			release = CDL
			create_march = CDL
			CDL = {
				capital_scope = {
					build_to_forcelimit = {
						infantry = 0.6
						cavalry = 0.3
						artillery = 0.1
					}
				}
				change_government = monarchy
				add_government_reform = autocracy_reform
				adopt_reform_progress = ROOT
			}
		}
	}
	
	option = {
		name = ming_crisis.4.a
		ai_chance = { factor = 1 }
		add_mandate = -5
		CDL = { add_liberty_desire = 100 }
	}
	option = {
		name = ming_crisis.4.b
		ai_chance = { factor = 0 }
		add_mandate = 15
		CDL = {
			declare_war_with_cb = {
				who = root
				casus_belli = cb_independence_war
			}
		}
	}
}

# Losing Control in the South
country_event = {
	id = ming_crisis.5
	title = "ming_crisis.5.t"
	desc = "ming_crisis.5.d"
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	major = yes
	
	trigger = {
		OR = {
			NOT = { exists = WUU }
			NOT = { exists = YUE }
		}
		num_of_owned_provinces_with = {
			value = 10
			region = south_china_region
			controlled_by = REB
		}
		any_owned_province = {
			OR = {
				area = zhejiang_area
				area = fujian_area
				area = guangdong_area
				area = west_guangdong_area
				area = guangxi_area
			}
		}
	}
	
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						exists = WUU
					}
				}
				hidden_effect = {
					every_owned_province = {
						limit = {
							OR = {
								controlled_by = REB
								controlled_by = ROOT
							}
							OR = {
								area = zhejiang_area
								area = fujian_area
							}
							OR = {
								controlled_by = REB
								controlled_by = ROOT
							}
							NOT = { is_core = WUU }
						}
						add_core = WUU
						clear_rebels = yes
					}
					release = WUU
					create_march = WUU
					WUU = {
						capital_scope = {
							build_to_forcelimit = {
								infantry = 0.6
								cavalry = 0.3
								artillery = 0.1
							}
						}
						change_government = monarchy
						add_government_reform = autocracy_reform
						adopt_reform_progress = ROOT
					}
				}
			}
			if = {
				limit = {
					NOT = {
						exists = YUE
					}
				}
				hidden_effect = {
					every_owned_province = {
						limit = {
							OR = {
								controlled_by = REB
								controlled_by = ROOT
							}
							OR = {
								area = guangdong_area
								area = west_guangdong_area
								area = guangxi_area
							}
							OR = {
								controlled_by = REB
								controlled_by = ROOT
							}
							NOT = { is_core = YUE }
						}
						add_core = YUE
						clear_rebels = yes
					}
					release = YUE
					create_march = YUE
					YUE = {
						capital_scope = {
							build_to_forcelimit = {
								infantry = 0.6
								cavalry = 0.3
								artillery = 0.1
							}
						}
						change_government = monarchy
						add_government_reform = autocracy_reform
						adopt_reform_progress = ROOT
					}
				}
			}
		}		
	}
	
	option = {
		name = ming_crisis.5.a
		ai_chance = { factor = 1 }
		add_mandate = -5
		if = {
			limit = {
				exists = YUE
				overlord_of = YUE
			}
			YUE = { add_liberty_desire = 100 }
		}
		if = {
			limit = {
				exists = WUU
				overlord_of = WUU
			}
			WUU = { add_liberty_desire = 100 }
		}
	}
	option = {
		name = ming_crisis.5.b
		ai_chance = { factor = 0 }
		add_mandate = 15
		if = {
			limit = {
				exists = YUE
				YUE = {
					is_subject_of = ROOT
				}
			}
			YUE = {
				declare_war_with_cb = {
					who = root
					casus_belli = cb_independence_war
				}
			}
		}
		if = {
			limit = {
				exists = WUU
				WUU = {
					is_subject_of = ROOT
				}
			}
			WUU = {
				declare_war_with_cb = {
					who = root
					casus_belli = cb_independence_war
				}
			}
		}
	}
}

# Peasants revolt in [area]
country_event = {
	id = ming_crisis.6
	title = "ming_crisis.6.t"
	desc = "ming_crisis.6.d"
	picture = ANGRY_MOB_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
		any_owned_province = {
			is_state = yes
			superregion = china_superregion
			NOT = { local_autonomy = 75 }
		}
	}
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = {
					is_state = yes
					superregion = china_superregion
					NOT = { local_autonomy = 75 }
				}
				save_event_target_as = ming_disaster_rebel_province
			}
		}
	}
	
	option = {
		name = ming_crisis.6.a
		ai_chance = { factor = 1 }
		add_mandate = 1
		event_target:ming_disaster_rebel_province = {
			spawn_rebels = {
				type = anti_tax_rebels 
				size = 3
			}
		}
	}
	option = {
		name = ming_crisis.6.b
		ai_chance = { factor = 1 }
		#add_mandate = -5
		event_target:ming_disaster_rebel_province = {
			area = {
				limit = {
					owned_by = ROOT
				}
				add_local_autonomy = 50
			}
		}
	}
}


# Gatekeeper for ending depending on whether you kept the Mandate or not
country_event = {
	id = ming_crisis.7
	title = none
	desc = none
	picture = none
	hidden = yes
	
	is_triggered_only = yes
	fire_only_once = yes
	
	immediate = {
		hidden_effect = {
			set_country_flag = ming_crisis_happened
		}
		if = {
			limit = {
				is_emperor_of_china = yes
			}
			country_event = { id = ming_crisis.2 }
		}
		else = {
			country_event = { id = ming_crisis.8 }
		}
	}
	option = { }
}

# The Mandate Restored
country_event = {
	id = ming_crisis.8
	title = "ming_crisis.8.t"
	desc = "ming_crisis.8.d"
	picture = CIVIL_WAR_eventPicture
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			random_country = {
				limit = {
					is_emperor_of_china = yes
				}
				save_event_target_as = emperor_of_china
			}
		}
	}
	
	option = {
		name = ming_crisis.8.a
		add_stability = 1
	}
}