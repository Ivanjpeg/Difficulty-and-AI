namespace = dif_manchu
#Nurhachi
country_event = { 
	id = dif_manchu.1
	title = "dif_manchu.EVTNAME1"
	desc = "dif_manchu.EVTDESC1"
	picture = ADVISOR_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		if = {
			limit = {
				NOT = { exists = MCH }
			}
			tag = MJZ
		}
		else = {
			tag = MCH
		}
		is_year = 1500
		NOT = { is_year = 1800 }
		NOT = { has_global_flag = nurhaci_spawned_flag }
	}
	
	mean_time_to_happen = {
		months = 500
		modifier = {
			factor = 0.5
			is_year = 1550
		}
		modifier = {
			factor = 0.5
			MNG = { has_any_disaster = yes }
		}
		modifier = {
			factor = 0.2
			is_year = 1575
		}
	}

	immediate = {
		set_global_flag = nurhaci_spawned_flag
		if = {
			limit = {
				has_heir = yes
			}
			hidden_effect = {
				kill_heir = yes
			}
		}
	}

	option = {
		name = "flavor_mch.EVTOPTA8"
		define_ruler = {
			name = "Nurhachi"
			dynasty = "Aisin Gioro"
			adm = 6
			dip = 4
			mil = 6
			fixed = yes
			age = 25
		}
		hidden_effect = {
			set_ruler_flag = nurhaci_ruler_flag
			add_ruler_personality = strict_personality
			add_ruler_modifier = {
				name = "great_unifier"
				duration = -1
				#desc = 
			}
			set_ai_personality = {
				personality = ai_militarist
				locked = yes
			}
		}
	}
}

# Unification Events
country_event = {
	id = dif_manchu.2
	title = "dif_manchu.EVTNAME2"
	desc = "dif_manchu.EVTDESC2"
	picture = LAND_MILITARY_eventPicture
	
	#fire_only_once = yes
	
	trigger = {
		NOT = { has_country_flag = country_manchu_unification }
		OR = {
			primary_culture = manchu
			primary_culture = manchu_new
		}		
		OR = {
			MJZ = {
				has_ruler_modifier = great_unifier
				OR = {
					alliance_with = ROOT
					ROOT = {
						is_subject_of = MJZ
						is_subject_of_type = tributary_state
					}
				}
			}
			MCH = {
				has_ruler_modifier = great_unifier
				OR = {
					alliance_with = ROOT
					ROOT = {
						is_subject_of = MCH
						is_subject_of_type = tributary_state
					}
				}
			}
		}
	}
	
	immediate = {
		set_country_flag = country_manchu_unification
	}

	mean_time_to_happen = {
		months = 15
	}

	option = {
		name = "dif_manchu.EVTOPTA2"
		
		if = {
			limit = { 
				MJZ = {
					has_ruler_modifier = great_unifier
				}
				OR = {
					MNG = {
						has_any_disaster = yes
					}
					exists = CSH
				}
			}
			every_owned_province = {
				cede_province = MJZ
				add_core = MJZ
			}
		}
		else_if = {
			limit = { 
				MCH = {
					has_ruler_modifier = great_unifier
				}
				OR = {
					MNG = {
						has_any_disaster = yes
					}
					exists = CSH
				}
			}
			every_owned_province = {
				cede_province = MCH
				add_core = MCH
			}
		}
		else_if = {
			limit = { 
				MJZ = {
					has_ruler_modifier = great_unifier
				}
			}
			MJZ = { vassalize = ROOT }
		}
		else_if = {
			limit = { 
				MCH = {
					has_ruler_modifier = great_unifier
				}
			}
			MCH = { vassalize = ROOT }
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				is_subject_of_type = tributary_state
			}
			modifier = {
				factor = 0.1
				MNG = { has_any_disaster = no }
				OR = {
					army_strength = {
						who = MJZ
						value = 0.8
					}
					army_strength = {
						who = MCH
						value = 0.8
					}
				}
			}
		}
	}

	option = {
		name = "dif_manchu.EVTOPTB2"
		if = {
			limit = {
				MJZ = {
					has_ruler_modifier = great_unifier
					alliance_with = ROOT
				}
			}
			MJZ = {
				add_opinion = {
					who = FROM
					modifier = opposed_unification
				}
			}
			add_historical_rival = MJZ
		}
		else_if = {
			limit = {
				MCH = {
					has_ruler_modifier = great_unifier
					alliance_with = ROOT
				}
			}
			MCH = {
				add_opinion = {
					who = FROM
					modifier = opposed_unification
				}
			}
			add_historical_rival = MCH
		}
		else_if = {
			limit = {
				MJZ = {
					has_ruler_modifier = great_unifier
					ROOT = {
						is_subject_of = MJZ
						is_subject_of_type = tributary_state
					}
				}
			}
			MJZ = {
				add_opinion = {
					who = FROM
					modifier = opposed_unification
				}
			}
			grant_independence = yes
		}
		else_if = {
			limit = {
				MCH = {
					has_ruler_modifier = great_unifier
					ROOT = {
						is_subject_of = MCH
						is_subject_of_type = tributary_state
					}
				}
			}
			MCH = {
				add_opinion = {
					who = FROM
					modifier = opposed_unification
				}
			}
			grant_independence = yes
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				is_subject_of_type = tributary_state
			}
			modifier = {
				factor = 5
				MNG = { has_any_disaster = no }
				OR = {
					army_strength = {
						who = MJZ
						value = 0.8
					}
					army_strength = {
						who = MCH
						value = 0.8
					}
				}
			}
		}
	}
}

# AI Manchu Decleres War on Ming
country_event = {
	id = dif_manchu.3
	title = "dif_manchu.EVTNAME3"
	desc = "dif_manchu.EVTDESC3"
	picture = LAND_MILITARY_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		is_at_war = no
		exists = MNG
		NOT = { vassal_of = MNG }
		tag = MCH
		is_bankrupt = no
		total_development = 300
		ai = yes
		OR = {
			is_year = 1600
			has_ruler_flag = nurhaci_ruler_flag
		}
		NOT = { is_year = 1675 }
		NOT = { war_with = MNG }
		any_owned_province = { 
			any_neighbor_province = { 
				owned_by = MNG 
				NOT = {
					is_claim = ROOT
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 100
	}
	
	option = {
		name = "dif_manchu.EVTOPTA3"
		declare_war_with_cb = {
			who = MNG
			casus_belli = cb_take_mandate
		}
		add_country_modifier = {
			name = "manchu_conqest_of_china_ai"
			duration = 7300
		}
		if = {
			limit = {
				num_of_loans = 1
			}
			add_treasury = 500
		}
		if = {
			limit = {
				MNG = { MCH = {	NOT = { mil_tech = PREV } } }
			}
			add_mil_tech = 1
		}
	}
}