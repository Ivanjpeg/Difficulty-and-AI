namespace = dif_manchu
#Nurhachi
country_event = { 
	id = dif_manchu.1
	title = "dif_manchu.EVTNAME1"
	desc = "dif_manchu.EVTDESC1"
	picture = ADVISOR_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		if = {
			limit = {
				NOT = { exists = MCH }
				MJZ = { num_of_cities = 6 }
			}
			tag = MJZ
		}
		else_if = {
			limit = { 
				NOT = { exists = MCH }
				MJZ = { NOT = { num_of_cities = 6 } }
			}
			custom_trigger_tooltip = {
				tooltip = root_is_most_powerful_manchuria_tribe
				OR = {
					primary_culture = manchu
					primary_culture = manchu_new
				}
				NOT = {
					any_country = {
						OR = {
							primary_culture = manchu
							primary_culture = manchu_new
						}
						OR = {
							army_size = root
							total_own_and_non_tributary_subject_development = root
						}
					}
				}
			}
		}
		else = {
			tag = MCH
		}
		OR = {
			is_year = 1500
			tag = MCH
		}
		NOT = { is_year = 1800 }
		NOT = { has_global_flag = nurhaci_spawned_flag }
	}
	
	mean_time_to_happen = {
		months = 500
		modifier = {
			factor = 2
			NOT = { is_year = 1525 }
		}
		modifier = {
			factor = 0.5
			tag = MCH
		}
		modifier = {
			factor = 0.5
			exists = CSH
		}
		modifier = {
			factor = 0.5
			is_year = 1550
		}
		modifier = {
			factor = 0.5
			MNG = { has_any_disaster = yes }
		}
		modifier = {
			factor = 0.2
			is_year = 1575
		}
	}

	immediate = {
		set_global_flag = nurhaci_spawned_flag
		if = {
			limit = {
				has_heir = yes
			}
			hidden_effect = {
				kill_heir = yes
			}
		}
	}

	option = {
		name = "flavor_mch.EVTOPTA8"
		define_ruler = {
			name = "Nurhachi"
			dynasty = "Aisin Gioro"
			adm = 6
			dip = 4
			mil = 6
			fixed = yes
			age = 20
		}
		hidden_effect = {
			set_ruler_flag = nurhaci_ruler_flag
			add_ruler_personality = strict_personality
			if = {
				limit = {
					ai = yes
				}
				add_ruler_modifier = {
					name = "great_unifier"
					duration = -1
					#desc = 
				}
			}
		
			set_ai_personality = {
				personality = ai_militarist
				locked = yes
			}
		}
	}
}

# Unification Events
country_event = {
	id = dif_manchu.2
	title = "dif_manchu.EVTNAME2"
	desc = "dif_manchu.EVTDESC2"
	picture = LAND_MILITARY_eventPicture
	
	#fire_only_once = yes
	
	trigger = {
		NOT = { has_country_flag = country_manchu_unification }
		OR = {
			primary_culture = manchu
			primary_culture = manchu_new
		}
		has_ruler_modifier = great_unifier
		OR = {
			any_ally = {
				ai = yes
				OR = {
					primary_culture = manchu
					primary_culture = manchu_new
				}
			}		
			any_subject_country = {
				ai = yes
				is_subject_of_type = tributary_state
				OR = {
					primary_culture = manchu
					primary_culture = manchu_new
				}
			}
		}
	}
	
	immediate = {
		set_country_flag = country_manchu_unification
	}

	mean_time_to_happen = {
		months = 15
	}

	option = {
		name = "dif_manchu.EVTOPTA2"
		if = {
			limit = {
				any_subject_country = {
					ai = yes
					is_subject_of_type = tributary_state
					OR = {
						primary_culture = manchu
						primary_culture = manchu_new
					}
				}
			}
			random_subject_country = {
				limit = {
					ai = yes
					is_subject_of_type = tributary_state
					OR = {
						primary_culture = manchu
						primary_culture = manchu_new
					}
				}	
				ROOT = { vassalize = PREV }
			}
		}
		else_if = {
			limit = {
				any_ally = {
					ai = yes
					OR = {
						primary_culture = manchu
						primary_culture = manchu_new
					}
				}	
			}
			random_ally = {
				limit = {
					ai = yes
					OR = {
						primary_culture = manchu
						primary_culture = manchu_new
					}
				}	
				ROOT = { vassalize = PREV }
			}
		}
		ai_chance = {
			factor = 10
		}
	}

	option = {
		name = "dif_manchu.EVTOPTB2"
		add_prestige = 15
		ai_chance = {
			factor = 0
		}
	}
}

# Unification Events
country_event = {
	id = dif_manchu.3
	title = "dif_manchu.EVTNAME3"
	desc = "dif_manchu.EVTDESC3"
	picture = LAND_MILITARY_eventPicture
	
	is_triggered_only = yes
	
	trigger = {
	}
	
	#immediate = {
	#	set_country_flag = country_manchu_unification
	#}

	option = {
		name = "dif_manchu.EVTOPTA3"
		if = {
			limit = {
				ai = yes
				is_subject_of_type = tributary_state
				overlord = { has_country_flag = country_manchu_unification }
				OR = {
					primary_culture = manchu
					primary_culture = manchu_new
				}
			}
			every_known_country = {
				limit = {
					overlord_of = ROOT
					has_country_flag = country_manchu_unification
				}	
				vassalize = ROOT
			}
		}
		else_if = {
			limit = {
				ai = yes
				OR = {
					primary_culture = manchu
					primary_culture = manchu_new
				}
				any_ally = {
					has_country_flag = country_manchu_unification
				}
			}
			every_ally = {
				limit = {
					has_country_flag = country_manchu_unification
				}	
				vassalize = ROOT
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 5
				is_subject_of_type = tributary_state
			}
		}
	}

	option = {
		name = "dif_manchu.EVTOPTB3"
		add_prestige = 15
		if = {
			limit = { 
				OR = {
					any_ally = {
						has_country_flag = country_manchu_unification
					}
					overlord = {
						has_country_flag = country_manchu_unification
					}
				}
			}
			every_known_country = {
				limit = {
					has_country_flag = country_manchu_unification
				}
				ROOT = { add_historical_rival = PREV }
				add_opinion = {
					who = PREV
					modifier = opposed_unification
				}
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				is_subject_of_type = tributary_state
			}
		}
	}
}


# AI Manchu Decleres War on Ming
country_event = {
	id = dif_manchu.4
	title = "dif_manchu.EVTNAME4"
	desc = "dif_manchu.EVTDESC4"
	picture = LAND_MILITARY_eventPicture
	
	#fire_only_once = yes
	
	trigger = {
		OR = {
			AND = {
				is_at_war = no
				is_bankrupt = no
				total_development = 300
				NOT = { truce_with = MNG }
				NOT = { alliance_with = MNG }
				any_owned_province = { 
					any_neighbor_province = { 
						owned_by = MNG 
						OR = {
							is_claim = ROOT
							is_core = ROOT
						}	
					}
				}
			}
			war_with = MNG
		}
		MNG = {
			is_emperor_of_china = yes
			ai = yes
		}
		exists = MNG
		NOT = { vassal_of = MNG }
		tag = MCH
		ai = yes
		MNG = { has_any_disaster = yes }
		#has_ruler_flag = nurhaci_ruler_flag
		NOT = { is_year = 1675 }
	}
	
	#immediate = {
	#	add_casus_belli = {
	#		target = MNG
	#		type = cb_border_war
	#		months = 24
	#	}
	#}

	mean_time_to_happen = {
		months = 100
		modifier = {
			factor = 0.01
			war_with = MNG
		}
		modifier = {
			factor = 0.25
			NOT = { imperial_mandate = 20 }
		}
		modifier = {
			factor = 0.25
			MNG = { has_any_disaster = yes }
		}
		modifier = {
			factor = 0.75
			exists = CSH
		}
	}
	
	option = {
		name = "dif_manchu.EVTOPTA4"
		if = {
			limit = {
				NOT = { has_country_modifier = manchu_conqest_of_china_ai }
			}
			add_country_modifier = {
				name = "manchu_conqest_of_china_ai"
				duration = 9125
				#desc = 
			}
		}
		if = {
			limit = {
				is_at_war = no
			}
			declare_war_with_cb = {
				who = MNG
				casus_belli = cb_take_mandate
			}
		}
		if = {
			limit = {
				num_of_loans = 1
			}
			add_treasury = 500
		}
		if = {
			limit = {
				MNG = { MCH = {	NOT = { mil_tech = PREV } } }
			}
			add_mil_tech = 1
		}
	}
}

country_event = {
	id = dif_manchu.5
	title = "dif_manchu.EVTNAME5"
	desc = "dif_manchu.EVTDESC5"
	picture = LAND_MILITARY_eventPicture
	
	#fire_only_once = yes
	
	trigger = {
		culture_group = east_asian
		ai = yes
		is_bankrupt = no
		NOT = { tag = MNG }
		OR = {
			any_ally = {
				ai = yes
				culture_group = east_asian
			}
			any_subject_country = { 
				ai = yes
				culture_group = east_asian
				is_subject_of_type = tributary_state
			}
		}
		custom_trigger_tooltip = {
			tooltip = strongest_power_in_china
			any_owned_province = {
				superregion = china_superregion
			}
			NOT = {
				any_country = {
					any_owned_province = {
						superregion = china_superregion
					}
					OR = {
						army_size = root
						total_own_and_non_tributary_subject_development = root
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 25
	}
	
	option = {
		name = "dif_manchu.EVTOPTA5"
		if = {
			limit = {
				any_subject_country = { 
					ai = yes
					culture_group = east_asian
					is_subject_of_type = tributary_state
				}
			}
			random_subject_country = {
				limit = {
					ai = yes
					culture_group = east_asian
					is_subject_of_type = tributary_state
				}	
				ROOT = { vassalize = PREV }
			}
		}
		else_if = {
			limit = { 
				any_ally = {
					ai = yes
					culture_group = east_asian
				}
			}
			random_ally = {
				add_historical_rival = ROOT
				add_opinion = {
					who = ROOT
					modifier = opposed_unification
				}
			}
		}
	}
}

country_event = { #AI only event
	id = dif_manchu.6
	title = "dif_manchu.EVTNAME6"
	desc = "dif_manchu.EVTDESC6"
	picture = LAND_MILITARY_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		MHX = {
			ai = yes
		}
		tag = MJZ
		ai = yes
		NOT = { is_year = 1445 }
	}

	mean_time_to_happen = {
		months = 1
	}
	
	option = {
		name = "dif_manchu.EVTOPTA6"
		if = {
			limit = {
				is_at_war = no
			}
			declare_war_with_cb = {
				who = MHX
				casus_belli = cb_tribal_feud
				war_goal_province = 730
			}
		}
		capital_scope = {
			PREV = {
				infantry = PREV
				infantry = PREV
				infantry = PREV
				infantry = PREV
			}
		}
	}
}